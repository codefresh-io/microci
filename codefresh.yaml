version: '1.0'

steps:

  multistage-build:
    type: build
    description: create MicroCI image with multi-stage build
    dockerfile: Dockerfile
    working-directory: ${{main_clone}}
    image-name: codefreshio/microci
    build_arguments:
      - GIT_COMMIT=${{CF_REVISION}}
      - GIT_BRANCH=${{CF_BRANCH}}
      # codecov variables (can detect Codefresh too)
      - CODECOV_TOKEN=${{CODECOV_TOKEN}}
      - BUILD_URL=${{CF_BUILD_URL}}
      - BUILD_ID=${{CF_BUILD_ID}}

  dockerhub-push:
    type: push
    candidate: ${{multistage-build}}
    tag: latest